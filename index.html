<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Narratio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
  <h1>Narratio</h1>

  <p><a href="privacy.html" rel="noopener">Политика конфиденциальности</a></p>

  <h3>Проверка /api/health</h3>
  <p id="health">Проверка...</p>

  <h3>Проверка /api/test</h3>
  <p id="test">Проверка...</p>

  <script>
    const API_BASE = 'https://narratio-backend-5asu.onrender.com';

    function fetchWithTimeout(url, opts = {}) {
      const { timeout = 15000 } = opts;
      return new Promise((resolve, reject) => {
        const ctrl = new AbortController();
        const t = setTimeout(() => {
          ctrl.abort();
          reject(new Error('timeout ' + timeout + 'ms'));
        }, timeout);
        fetch(url, { signal: ctrl.signal })
          .then(r => { clearTimeout(t); resolve(r); })
          .catch(err => { clearTimeout(t); reject(err); });
      });
    }

    async function load(endpoint, targetId) {
      const el = document.getElementById(targetId);
      try {
        // 1 попытка + 1 ретрай при ошибке
        let res = await fetchWithTimeout(`${API_BASE}${endpoint}`, { timeout: 15000 });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        let data = await res.json();
        el.textContent = 'Бэкенд ответил: ' + JSON.stringify(data);
      } catch (e1) {
        try {
          let res2 = await fetchWithTimeout(`${API_BASE}${endpoint}`, { timeout: 15000 });
          if (!res2.ok) throw new Error('HTTP ' + res2.status);
          let data2 = await res2.json();
          el.textContent = 'Бэкенд ответил: ' + JSON.stringify(data2);
        } catch (e2) {
          el.textContent = 'Ошибка: ' + (e2.message || String(e2));
        }
      }
    }

    load('/api/health', 'health');
    load('/api/test', 'test');
  </script>
</body>
</html>

